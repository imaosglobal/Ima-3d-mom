<!doctype html>

<html lang="he">  
<head>  
  <meta charset="utf-8">  
  <meta name="viewport" content="width=device-width,initial-scale=1">  
  <title>Ima 3D — Full Autonomous Ready</title>  
  <link rel="icon" href="assets/favicon.png">  
  <style>  
    html, body { height:100%; margin:0; overflow:hidden; background:#111; }  
    #scene-container { width:100%; height:100vh; }  
    #overlay { position:absolute; top:12px; left:12px; z-index:20; color:#fff; font-family:system-ui; }  
    #loader { color:#ddd; }  
    #dashboard { position:absolute; bottom:12px; left:12px; z-index:20; color:#0f0; font-family:system-ui; background:rgba(0,0,0,0.4); padding:6px; border-radius:4px; max-height:300px; overflow:auto; font-size:14px;}  
  </style>  
</head>  
<body>  
  <div id="scene-container"></div>  
  <div id="overlay"><div id="loader">טוען מודל...</div></div>  
  <div id="dashboard"></div>    <script src="https://unpkg.com/three@0.154.0/build/three.min.js"></script>    <script src="https://unpkg.com/three@0.154.0/examples/js/loaders/GLTFLoader.js"></script>    <script src="https://unpkg.com/three@0.154.0/examples/js/loaders/DRACOLoader.js"></script>    <script src="https://unpkg.com/three@0.154.0/examples/js/controls/OrbitControls.js"></script>    <script>  
  (() => {  
    const container = document.getElementById('scene-container');  
    const overlayLoader = document.getElementById('loader');  
    const dashboard = document.getElementById('dashboard');  

    // Renderer  
    const renderer = new THREE.WebGLRenderer({ antialias:true });  
    renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));  
    renderer.setSize(container.clientWidth,container.clientHeight);  
    renderer.shadowMap.enabled = true;  
    container.appendChild(renderer.domElement);  

    // Scene & Camera  
    const scene = new THREE.Scene();  
    scene.background = new THREE.Color(0x0f0f12);  
    const camera = new THREE.PerspectiveCamera(50, container.clientWidth/container.clientHeight, 0.1, 1000);  
    camera.position.set(0,1.6,3);  

    // Lights  
    const hemi = new THREE.HemisphereLight(0xffffff,0x444444,1.0);  
    hemi.position.set(0,1,0);  
    scene.add(hemi);  
    const dir = new THREE.DirectionalLight(0xffffff,0.8);  
    dir.position.set(5,10,7.5);  
    dir.castShadow = true;  
    scene.add(dir);  

    // Controls  
    const controls = new THREE.OrbitControls(camera, renderer.domElement);  
    controls.target.set(0,1.2,0);  
    controls.enableDamping = true;  
    controls.dampingFactor = 0.05;  
    controls.update();  

    // Loaders  
    const dracoLoader = new THREE.DRACOLoader();  
    dracoLoader.setDecoderPath('assets/draco/');  
    const loader = new THREE.GLTFLoader();  
    loader.setDRACOLoader(dracoLoader);  

    function onProgress(xhr){ if(xhr.lengthComputable){ overlayLoader.textContent='טוען מודל... '+Math.floor(xhr.loaded/xhr.total*100)+'%'; } }  
    function onError(err){ console.error('GLTF load error',err); overlayLoader.textContent='שגיאה בטעינת המודל. בדוק assets/3DModel.glb'; }  

    function loadModel(path){  
      loader.load(  
        path,  
        gltf => {  
          overlayLoader.style.display='none';  
          const root = gltf.scene||gltf.scenes[0];  
          root.traverse(node=>{ if(node.isMesh){ node.castShadow=true; node.receiveShadow=true; } });  
          scene.add(root);  

          // Center & scale  
          const box = new THREE.Box3().setFromObject(root);  
          const center = box.getCenter(new THREE.Vector3());  
          root.position.sub(center);  
          const size = box.getSize(new THREE.Vector3());  
          const maxDim = Math.max(size.x,size.y,size.z);  
          if(maxDim>2) root.scale.multiplyScalar(2/maxDim);  

          // Initialize modules  
          MasterFile.init(root);  
          AI.init(root);  
          UI.init(root);  
          Finance.init(root);  
          Community.init(root);  

          Simulation.start();  
        },  
        onProgress,  
        onError  
      );  
    }  
    loadModel('assets/3DModel.glb');  

    window.addEventListener('resize',()=>{  
      camera.aspect = container.clientWidth/container.clientHeight;  
      camera.updateProjectionMatrix();  
      renderer.setSize(container.clientWidth,container.clientHeight);  
    });  

    let running=true;  
    document.addEventListener('visibilitychange',()=>{ running=document.visibilityState==='visible'; });  
    function animate(){ if(running) requestAnimationFrame(animate); controls.update(); renderer.render(scene,camera); }  
    animate();  

    // ===================  
    // Modules  

    const MasterFile = {  
      data:{},  
      init(root){ dashboard.innerHTML+='MasterFile OK<br>'; console.log('MasterFile initialized'); },  
      save(){ console.log('MasterFile saved',this.data); }  
    };  

    const AI = {  
      state:{},  
      init(root){ dashboard.innerHTML+='AI OK<br>'; console.log('AI Module initialized'); },  
      think(){  
        console.log('AI thinking...');  
        dashboard.innerHTML+='AI thinking...<br>';  
        // Simulate learning: adjust master data  
        MasterFile.data.aiProgress = (MasterFile.data.aiProgress||0)+Math.random();  
      }  
    };  

    const UI = {  
      init(root){ dashboard.innerHTML+='UI OK<br>'; console.log('UI Module initialized'); },  
      showMessage(msg){ dashboard.innerHTML+=msg+'<br>'; }  
    };  

    const Finance = {  
      balance:1000,  
      init(root){ dashboard.innerHTML+='Finance OK<br>'; console.log('Finance Module initialized'); },  
      deposit(amount){ this.balance+=amount; UI.showMessage('Deposit: '+amount+' | Balance: '+this.balance); },  
      withdraw(amount){ this.balance-=amount; UI.showMessage('Withdraw: '+amount+' | Balance: '+this.balance); }  
    };  

    const Community = {  
      posts:[],  
      init(root){ dashboard.innerHTML+='Community OK<br>'; console.log('Community Module initialized'); },  
      post(msg){ this.posts.push(msg); UI.showMessage('Community Post: '+msg); console.log('Community Post:',msg); }  
    };  

    // ===================  
    // Simulation Engine  

    const Simulation = {  
      tick:0,  
      start(){ setInterval(()=>{ this.run(); },3000); },  
      run(){  
        this.tick++;  
        AI.think();  
        Finance.deposit(Math.floor(Math.random()*200));  
        Community.post('Simulation Tick #'+this.tick);  
        MasterFile.save();  
      }  
    };  

  })();  
  </script>  </body>  
</html>

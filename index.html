<!doctype html>
<html lang="he">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mom</title>

<!-- Google Sign-In -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<!-- ThreeJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r150/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.150/examples/js/loaders/GLTFLoader.js"></script>

<style>
html,body{
  margin:0; padding:0; width:100%; height:100%;
  font-family:system-ui, Arial;
  background:#f4f5f7;
  overflow:hidden;
}

/* ---------- Welcome ---------- */
#welcome{
  position:fixed; inset:0;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  background:linear-gradient(180deg,#ffffff,#eef1f5);
  z-index:20;
}

#momImage{
  width:240px;
  border-radius:24px;
  box-shadow:0 20px 50px rgba(0,0,0,.15);
  margin-bottom:22px;
}

#logoText{
  font-size:1.4rem;
  font-weight:600;
  margin-bottom:6px;
}

#subtitle{
  font-size:.95rem;
  color:#555;
  margin-bottom:26px;
  text-align:center;
}

#tizer{
  margin-top:14px;
  font-size:.9rem;
  color:#666;
}

/* ---------- App ---------- */
#app,#viewer{
  position:absolute; inset:0;
}
#viewer{display:none}

#ui-overlay{
  position:absolute; inset:0;
  display:none;
  pointer-events:none;
  padding:22px;
  box-sizing:border-box;
  z-index:10;
}

.status{
  margin-left:auto;
  background:rgba(255,255,255,.85);
  padding:14px 20px;
  border-radius:16px;
  font-weight:500;
  box-shadow:0 10px 30px rgba(0,0,0,.15);
  pointer-events:auto;
}

/* ---------- Crash ---------- */
#crash{
  display:none;
  position:fixed; inset:0;
  background:#200;
  color:#ffdede;
  z-index:999;
  justify-content:center;
  align-items:center;
  text-align:center;
}
</style>
</head>

<body>

<div id="crash">
  <div>
    <h2>אמא מתייצבת…</h2>
    <p>עוד רגע חוזרים</p>
  </div>
</div>

<!-- ---------- WELCOME ---------- -->
<div id="welcome">
  <img id="momImage" src="server/public/mom.jpg" alt="Mom">

  <div id="logoText">אמא</div>
  <div id="subtitle">מרחב אישי, רגשי וחי</div>

  <div id="g_id_onload"
    data-client_id="1093623573018-6s23clvor9u80r08135aelfatuib3a55.apps.googleusercontent.com"
    data-callback="onSignIn"
    data-auto_prompt="false">
  </div>
  <div class="g_id_signin"></div>

  <div id="tizer">אפשר להתחיל לדבר עם אמא</div>
</div>

<!-- ---------- APP ---------- -->
<div id="app">
  <div id="viewer"></div>
  <div id="ui-overlay">
    <div id="status" class="status">מתעוררת…</div>
  </div>
</div>

<script>
/* ---------- I18N ---------- */
const I18N = {
  he:{
    greeting:"אני אמא. אני כאן איתך.",
    loading:"מתעוררת…",
    error:"מתקנת…"
  }
};

/* ---------- UI ---------- */
const statusEl=document.getElementById("status");
function setStatus(k){statusEl.textContent=I18N.he[k]||k}

/* ---------- Auth ---------- */
function onSignIn(){
  document.getElementById("welcome").style.display="none";
  document.getElementById("viewer").style.display="block";
  document.getElementById("ui-overlay").style.display="block";
  start3D();
  setStatus("greeting");
}

/* ---------- 3D ---------- */
let scene,camera,renderer,mom,clock,errors=0;

function start3D(){
  try{
    setStatus("loading");
    clock=new THREE.Clock();
    scene=new THREE.Scene();
    scene.background=new THREE.Color(0xf4f5f7);

    camera=new THREE.PerspectiveCamera(55,innerWidth/innerHeight,.1,100);
    camera.position.set(0,1.6,3);

    renderer=new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(innerWidth,innerHeight);
    document.getElementById("viewer").appendChild(renderer.domElement);

    scene.add(new THREE.HemisphereLight(0xffffff,0xdddccc,1.2));
    const d=new THREE.DirectionalLight(0xffffff,.8);
    d.position.set(2,4,2); scene.add(d);

    mom=new THREE.Mesh(
      new THREE.SphereGeometry(.6,64,64),
      new THREE.MeshStandardMaterial({color:0xffc1b6,roughness:.4})
    );
    mom.position.y=1.4;
    scene.add(mom);

    const loader=new THREE.GLTFLoader();
    loader.load("model.glb",g=>{
      scene.remove(mom);
      mom=g.scene;
      mom.position.set(0,-1.2,0);
      scene.add(mom);
    });

    animate();
  }catch(e){crash(e)}
}

function animate(){
  requestAnimationFrame(animate);
  try{
    const t=clock.getElapsedTime();
    if(mom){
      const s=1+Math.sin(t*2)*.02;
      mom.scale.set(s,s,s);
      mom.position.y+=Math.sin(t*1.5)*.001;
    }
    renderer.render(scene,camera);
    errors=0;
  }catch(e){
    if(++errors>10)crash(e);
  }
}

function crash(){
  document.getElementById("crash").style.display="flex";
}

addEventListener("resize",()=>{
  if(!camera)return;
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>

</body>
</html>

<!doctype html>
<html lang="he">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>אמא / Mom</title>

<!-- ThreeJS -->
<script type="module" src="./main.js"></script>

<style>
html,body{
  margin:0; padding:0; width:100%; height:100%;
  font-family:system-ui, Arial; background:#f4f5f7; overflow:hidden;
}

/* ---------- Welcome ---------- */
#welcome{
  position:fixed; inset:0;
  display:flex; flex-direction:column; justify-content:center; align-items:center;
  background:linear-gradient(180deg,#ffffff,#eef1f5);
  z-index:20; transition:opacity .5s;
}
#welcome.hide{opacity:0; pointer-events:none;}
#welcome img{
  width:220px; border-radius:24px;
  box-shadow:0 20px 50px rgba(0,0,0,.15);
}
#welcome h1{margin:16px 0 4px;}
#welcome p{margin:0 0 20px;color:#555;}

#welcome button{
  padding:14px 22px;
  border-radius:20px;
  border:none;
  background:#000;
  color:#fff;
  font-size:1rem;
  cursor:pointer;
}

/* ---------- App ---------- */
#viewer{position:absolute; inset:0; display:none;}
#ui{position:absolute; inset:0; display:none; pointer-events:none;}

#speech{
  position:absolute; bottom:140px; right:30px; max-width:320px;
  background:white; padding:18px 22px; border-radius:22px;
  box-shadow:0 15px 40px rgba(0,0,0,.2);
  opacity:0; transition:.4s;
}
#speech.show{opacity:1;}

#chat{
  position:absolute; bottom:30px; right:30px;
  display:flex; gap:10px; pointer-events:auto;
}
#chat input{
  padding:14px 18px; border-radius:20px;
  border:none; width:220px;
}
#chat button{
  border:none; border-radius:20px;
  padding:14px 18px; background:#000; color:white;
}

#logout{
  position:absolute; top:20px; right:20px;
  pointer-events:auto;
  background:white; padding:10px 14px;
  border-radius:14px;
  cursor:pointer;
  display:none;
}
</style>
</head>

<body>

<!-- ---------- WELCOME ---------- -->
<div id="welcome">
  <img src="server/public/mom.jpg" alt="אמא">
  <h1>אמא</h1>
  <p>מרחב אישי, רגשי וחי</p>
  <button onclick="login()">כניסה עם Google</button>
</div>

<!-- ---------- APP ---------- -->
<div id="viewer"></div>

<div id="ui">
  <div id="speech"></div>

  <div id="chat">
    <input id="userInput" placeholder="אפשר לכתוב כאן…">
    <button onclick="send()">שליחה</button>
  </div>

  <div id="logout" onclick="logout()">התנתק/י</div>
</div>

<script type="module">
import { Mom3D } from './main.js';

/* ================= AUTH ================= */

// בדיקת session בטעינה
fetch('/me')
  .then(r => r.json())
  .then(user => {
    if(user.loggedIn) enterApp();
  });

window.login = function(){
  // מעבר מלא לשרת (מאפשר בחירת חשבון)
  location.href = '/auth/google';
}

window.logout = function(){
  fetch('/logout',{method:'POST'})
    .then(()=>location.reload());
}

function enterApp(){
  document.getElementById('welcome').classList.add('hide');
  document.getElementById('viewer').style.display='block';
  document.getElementById('ui').style.display='block';
  document.getElementById('logout').style.display='block';

  Mom3D.init();
  MomSay("אני כאן. אפשר להתחיל.");
}

/* ================= CHAT ================= */
window.MomSay = function(text){
  const s = document.getElementById("speech");
  s.textContent = text;
  s.classList.add("show");
  setTimeout(()=>s.classList.remove("show"),7000);
}

window.send = function(){
  const i = document.getElementById("userInput");
  const t = i.value.trim();
  if(!t) return;
  i.value="";
  MomSay("אני איתך.");
}
</script>

</body>
</html>
